function getUrlParameterByName(i){i=i.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function initMusic(){var i=$("audio")[0];$(".player-btn").on("click",function(){var t=$(this);t.hasClass("player-btn-stop")?i.play():i.pause(),t.toggleClass("player-btn-stop")})}function initPageEvents(){$("body").on("touchmove",function(i){i.preventDefault()}),$(".page1").on("click",".intro-text",function(){$(".intro-mask").show()}),$(".intro-mask").on("click",".close",function(){$(this).parents(".intro-mask").hide()});var i=0;$(".page2").one("click",".tree:eq(0)",function(){i++,$(this).find("img:eq(1)").hide(),$(this).find(".text").fadeIn(),3==i&&setTimeout(showText,2e3)}),$(".page2").one("click",".tree:eq(1)",function(){i++,$(this).find("img:eq(1)").hide(),$(this).find(".text").fadeIn(),3==i&&setTimeout(showText,2e3)}),$(".page2").one("click",".tree:eq(2)",function(){i++,$(this).find("img:eq(1)").hide(),$(this).find(".text").fadeIn(),3==i&&setTimeout(showText,2e3)}),$(".start .btn").on("click",function(){app.swiper.slideTo(3,0,!1),hanldeAnimate(3)}),$(".start .btn-rule").on("click",function(){$(".rule-mask").show()}),$(".rule-mask").on("click",".close",function(){$(this).parents(".rule-mask").hide()});var t;$(".sidebar").one("click","li",function(){$(this).addClass("cur"),t=0==$(this).index()?"yang":1==$(this).index()?"liu":"xing",$(".litter-tree").fadeIn(500),$(".sidebar").find("ul").removeClass("right-in").addClass("right-out"),$(".sidebar").find(".tit").removeClass("right-in").addClass("right-out"),setTimeout(function(){$(".sidebar1").hide(),$(".sidebar2").show()},1e3)});var e=0,n=0,a=0,s=0;$(".sidebar2").on("click","li",function(){if(!($(this).hasClass("dis")||e>=4)){var i=$(this);e++,$(".sidebar2 li").addClass("dis"),i.addClass("cur"),0==i.index()?(n++,$(".tips-shui"+n).delay(500).fadeIn(500),$(".shui").fadeIn(300)):1==i.index()?(a++,$(".tips-sun"+a).delay(500).fadeIn(500),$(".sun").fadeIn(300)):(s++,$(".tips-chong"+s).delay(500).fadeIn(500),$(".chong").fadeIn(300),$(".wave").show(),setTimeout(function(){$("audio")[2].play()},300),setTimeout(function(){$(".wave").hide()},1500)),setTimeout(function(){$(".sidebar2 li").removeClass("dis"),i.removeClass("cur"),$(".shui").hide(),$(".sun").hide(),$(".chong").hide(),$(".page4 .tips").hide()},2e3),1==e?setTimeout(function(){$(".litter-tree").fadeOut(1e3),$("."+t+e).fadeIn(1e3)},800):(setTimeout(function(){$("."+t+(e-1)).fadeOut(1e3),$("."+t+e).fadeIn(1e3)},800),4==e&&setTimeout(function(){$(".text-"+t).show(),"liu"==t&&$(".tips-yc").addClass("tips-yc-liu"),$(".tips-yc").show(),$(".page4").removeClass("swiper-no-swiping"),app.swiper.update(),$(".arrow").show()},1500))}}),$(".sound").on("click",function(){$("audio")[1].play()});var p;$("#form input").on("focus",function(){p=$(this).attr("placeholder"),$(this).attr("placeholder","")}).on("blur",function(){$(this).attr("placeholder",p)}),$("#form").on("click",".btn",function(){return $.trim($("#form input[name=name]").val())?$.trim($("#form input[name=mobile]").val())?/^1\d{10}$/.test($.trim($("#form input[name=mobile]").val()))?($.ajax({url:"http://www.xinliling.com/trees",type:"POST",dataType:"json",data:$("#form").serialize()}).done(function(i){var t={title:"我今天种下了第"+i.total_tree+"棵树，成为湘江的第"+i.total_user+"位绿化天使 "};weixin.bindData(t),weixin.bindShareInfo();for(var e,n="0",n=i.total_tree.toString().split(""),a=0;a<n.length;a++)e+='<span class="num'+n[a]+'"></span>';var s="0";s=i.total_user.toString().split("");for(var p,a=0;a<s.length;a++)p+='<span class="num'+s[a]+'"></span>';$(".page6 .result2 .num").html(e),$(".page6 .result4 .num").html(p),$(".page6").find(".text").hide(),$(".page6").find(".result").show(),$(".page6").find(".logo").fadeIn(500),$(".page6").find(".p5-intro").show()}).fail(function(i){422==i.status?alert(i.responseText):alert("网络错误，请稍后重试")}),!1):(alert("电话号码格式不正确"),!1):(alert("手机号码不能为空！"),!1):(alert("姓名不能为空！"),!1)})}function showText(){$(".page2 .bird").addClass("birdm").find("img").addClass("birdh"),$(".page2 .r-tree").animate({opacity:"0.3"}),$(".fix-text1").show(),setTimeout(function(){$(".page2").removeClass("swiper-no-swiping"),app.swiper.update(),$(".arrow").show()},3e3)}function checkIsPC(){var i={win:!1,mac:!1,xll:!1},t=navigator.platform;i.win=0==t.indexOf("Win"),i.mac=0==t.indexOf("Mac"),i.x11="X11"==t||0==t.indexOf("Linux");return!!($(window).width()>app.DEFAULT_WIDTH&&(i.win||i.mac||i.xll))}function hanldeAnimate(i){$(".swiper-slide").find("[data-anim]").each(function(){$(this).removeClass($(this).data("anim"))}),$(".swiper-slide").eq(i).find("[data-anim]").each(function(){$(this).addClass($(this).data("anim"))})}function fit(i){var t,e=$(window).width(),n=$(window).height();t=e/n>app.DEFAULT_WIDTH/app.DEFAULT_HEIGHT?n/app.DEFAULT_HEIGHT:e/app.DEFAULT_WIDTH,$(i).css({"-webkit-transform":"scale("+t+")",transform:"scale("+t+")","-webkit-transform-origin":"50% 50% 0","transform-origin":"50% 50% 0","margin-left":(app.DEFAULT_WIDTH-e)/-2+"px","margin-top":(app.DEFAULT_HEIGHT-n)/-2+"px"})}var app={};app.width,app.height,app.loop=!1,app.DEFAULT_WIDTH=750,app.DEFAULT_HEIGHT=1212,app.init=function(){app.loop=getUrlParameterByName("loop")||!1;var i=["static/img/p2/p2-paper.png","static/img/p2/p2-text1.png","static/img/p2/p2-text2.png","static/img/p2/p2-text3.png","static/img/p2/p2-text4.png","static/img/p2/p2-text5.png","static/img/p3/p3-sidebar.png","static/img/p3/p3-select.png","static/img/p3/sidebar2.png","static/img/p3/nengliang-select.png","static/img/p3/text-yang.png","static/img/p3/text-liu.png","static/img/p3/text-xing.png","static/img/p4/p4-text.png","static/img/p5/p5-text.png","static/img/p5/input.png","static/img/p5/btn-sub.png","static/img/p5/p5-text2.png","static/img/p5/num.png","static/img/p5/p5-text2.png"];$.each($("#content img"),function(t){i.push($(this).attr("src"))}),$.imgpreload(i,{each:function(t){if("success"==($(this).data("loaded")?"success":"error")){var e=(t.length/i.length).toFixed(2);$("#percentage").html(Math.round(100*e)+"%")}},all:function(){setTimeout(function(){$(".loading").hide(0,function(){hanldeAnimate(0)})},500)}});var t=$(window).height()>app.DEFAULT_HEIGHT?$(window).height():app.DEFAULT_HEIGHT;app.swiper=new Swiper(".swiper-container",{direction:"vertical",loop:app.loop,longSwipesRatio:.1,initialSlide:0,preventClicks:!0,preventClicksPropagation:!0,width:app.DEFAULT_WIDTH,height:t,noSwiping:!0,allowSlidePrev:!1,on:{slideChangeTransitionEnd:function(){if(!app.loop){var i=$(".arrow"),t=$(".swiper-slide").length;hanldeAnimate(this.activeIndex),this.activeIndex==t-2?(i.show(),setTimeout(function(){$(".page5 .text-1").hide(),$(".page5 .text-2").show()},3500)):this.activeIndex>=t-1?($("audio")[1].pause(),i.hide()):i.hide()}}}}),initMusic()},$(function(){app.init();app.swiper.slides.length,app.swiper.activeIndex;var i=$("audio")[0],t=$(".player-btn");i&&i.play(),document.addEventListener("WeixinJSBridgeReady",function(){t.hasClass("player-btn-stop")?i.pause():i.play()},!1),initPageEvents()});